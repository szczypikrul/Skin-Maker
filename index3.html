<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kreator skina Minecraft</title>
<style>
body { background:#0b0f14; color:white; font-family:sans-serif; margin:0; }
main { display:flex; gap:20px; padding:20px; }
.panel { background:#121924; padding:16px; border-radius:12px; flex:1; }
label { display:block; margin-top:8px; }
input, select, button { margin-top:4px; padding:8px; border-radius:8px; border:none; }
button { cursor:pointer; background:#2a79ff; color:white; }
canvas { image-rendering:pixelated; border:1px solid #444; background:#000; }
</style>
</head>
<body>
<h1 style="padding:20px; margin:0; background:#0e1520;">ðŸŽ¨ Kreator skina Minecraft</h1>
<main>
<div class="panel">
<h2>Warstwy</h2>
<label>SkÃ³ra</label>
<select id="skinSelect">
  <option value="skin1.png">Skin 1</option>
  <option value="skin2.png">Skin 2</option>
</select>

<label>Oczy - wariant</label>
<select id="eyesVariant">
  <option value="1">Wariant 1</option>
  <option value="2">Wariant 2</option>
</select>

<label>Oczy - kolor</label>
<input type="color" id="eyesColor" value="#2aa1ff">

<label>Ubrania</label>
<select id="clothesSelect">
  <option value="clothes1.png">Clothes 1</option>
  <option value="clothes2.png">Clothes 2</option>
</select>

<label>WÅ‚osy</label>
<select id="hairSelect">
  <option value="hair1.png">Hair 1</option>
  <option value="hair2.png">Hair 2</option>
</select>

<div style="margin-top:12px;">
<button id="applyBtn">Zastosuj na modelu</button>
<button id="downloadBtn">Pobierz PNG</button>
</div>
</div>

<div class="panel">
<h2>PodglÄ…d</h2>
<canvas id="texCanvas" width="64" height="64"></canvas>
<div id="viewer" style="width:100%; height:400px; margin-top:12px;"></div>
</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/skinview3d@3.1.0/bundles/skinview3d.bundle.min.js"></script>
<script>
const canvas = document.getElementById("texCanvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

// Funkcja do Å‚adowania obrazu
function loadImage(src) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = () => resolve(img);
    img.onerror = reject;
    img.src = src;
  });
}

// Rysowanie oczu
function drawEyes(variant, hexColor) {
  const rgb = hexColor.match(/[0-9a-f]{2}/gi).map(c => parseInt(c,16));
  const eye = (x,y) => {
    ctx.fillStyle = "#fff"; ctx.fillRect(x, y, 2, 2);
    ctx.fillStyle = `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`; ctx.fillRect(x+1, y+1, 1, 1);
    ctx.fillStyle = "#000"; ctx.fillRect(x+1, y+1, 1, 1);
  };
  if (variant == 1) { eye(10,10); eye(14,10); }
  else { eye(10,11); eye(14,11); }
}

// Budowanie tekstury
async function rebuildTexture() {
  const skinImg = await loadImage(document.getElementById("skinSelect").value);
  const clothesImg = await loadImage(document.getElementById("clothesSelect").value);
  const hairImg = await loadImage(document.getElementById("hairSelect").value);

  ctx.clearRect(0,0,64,64);
  ctx.drawImage(skinImg, 0, 0);
  drawEyes(parseInt(document.getElementById("eyesVariant").value), document.getElementById("eyesColor").value);
  ctx.drawImage(clothesImg, 0, 0);
  ctx.drawImage(hairImg, 0, 0);
}

// Skinview3D
const skinViewer = new skinview3d.SkinViewer({
  domElement: document.getElementById("viewer"),
  width: document.getElementById("viewer").clientWidth,
  height: 400,
  animation: new skinview3d.IdleAnimation()
});
skinViewer.controls.enableZoom = true;

async function applyToViewer() {
  await rebuildTexture();
  canvas.toBlob(blob => {
    const url = URL.createObjectURL(blob);
    skinViewer.loadSkin(url);
  });
}

document.getElementById("applyBtn").addEventListener("click", applyToViewer);
document.getElementById("downloadBtn").addEventListener("click", async () => {
  await rebuildTexture();
  const link = document.createElement("a");
  link.download = "minecraft-skin.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});

// Auto start
applyToViewer();
</script>
</body>
</html>
